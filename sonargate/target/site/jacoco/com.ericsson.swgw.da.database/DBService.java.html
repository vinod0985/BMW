<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>DBService.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">eric-swgwda</a> &gt; <a href="index.source.html" class="el_package">com.ericsson.swgw.da.database</a> &gt; <span class="el_source">DBService.java</span></div><h1>DBService.java</h1><pre class="source lang-java linenums">package com.ericsson.swgw.da.database;

import java.sql.Connection;
import java.sql.DriverManager;
import java.util.Collection;
import java.util.Iterator;
import java.util.LinkedList;
import java.util.Properties;
//import org.apache.commons.dbcp2.BasicDataSource;
//import org.apache.commons.dbcp2.BasicDataSourceFactory;
import com.ericsson.swgw.da.constants.DBConstants;
<span class="fc" id="L12">public class DBService {</span>

	//private static BasicDataSource dataSource;

<span class="fc" id="L16">	static String driver = DBConstants.DRIVER;</span>
<span class="fc" id="L17">	static String url = DBConstants.URL;</span>
<span class="fc" id="L18">	static String user = DBConstants.USER;</span>
<span class="fc" id="L19">	static String pass = DBConstants.PASS;	</span>
	
	public static void init() throws Exception{	            
	      
<span class="pc bpc" id="L23" title="3 of 6 branches missed.">	      if (driver == null || url == null || user == null) {</span>
<span class="nc" id="L24">	            driver = &quot;org.apache.derby.jdbc.EmbeddedDriver&quot;;</span>
<span class="nc" id="L25">	            url = &quot;jdbc:derby:DADB&quot;;</span>
<span class="nc" id="L26">	            user = DBConstants.USER;</span>
<span class="nc" id="L27">	            pass = DBConstants.PASS;	</span>
	      }
	      
<span class="fc" id="L30">	      Properties dbcpProperties = new Properties();</span>
<span class="fc" id="L31">	      setDataSourceProperty(dbcpProperties, &quot;driverClassName&quot;, driver);</span>
<span class="fc" id="L32">	      setDataSourceProperty(dbcpProperties, &quot;url&quot;, url);</span>
<span class="fc" id="L33">	      setDataSourceProperty(dbcpProperties, &quot;username&quot;, user);</span>
<span class="fc" id="L34">	      setDataSourceProperty(dbcpProperties, &quot;password&quot;, pass);</span>
<span class="fc" id="L35">	      setDataSourceProperty(dbcpProperties, &quot;connectionProperties&quot;, &quot;;create=true;upgrade=true&quot;);</span>
<span class="fc" id="L36">	      setDataSourceProperty(dbcpProperties, &quot;defaultAutoCommit&quot;, String.valueOf(Boolean.FALSE));</span>
<span class="fc" id="L37">	      setDataSourceProperty(dbcpProperties, &quot;maxTotal&quot;, &quot;20&quot;);</span>
<span class="fc" id="L38">	      setDataSourceProperty(dbcpProperties, &quot;poolPreparedStatements&quot;, String.valueOf(Boolean.TRUE));</span>
<span class="fc" id="L39">	      setDataSourceProperty(dbcpProperties, &quot;maxOpenPreparedStatements&quot;, &quot;50&quot;);</span>
	      
	      try {
	            //dataSource = BasicDataSourceFactory.createDataSource(dbcpProperties);
	         } catch (Exception var11) {
	            throw new Exception(var11);
	         }	
<span class="fc" id="L46">	}</span>
	
	private static void setDataSourceProperty(Properties dbcpProperties, String name, String defaultValue) {
	      //String value = String.format(&quot;db.connection.%s&quot;, name), defaultValue;
<span class="fc" id="L50">	      dbcpProperties.put(name, defaultValue);</span>
<span class="fc" id="L51">	}</span>
	
	
	@SuppressWarnings({ &quot;rawtypes&quot;, &quot;unchecked&quot; })
	public void initialize() throws Exception {
<span class="nc" id="L56">		Collection&lt;ModuleInitializer&gt; initializers = new LinkedList();</span>
<span class="nc" id="L57">		initializers.add(new DBInitializer());</span>
		
<span class="nc" id="L59">		Iterator var4 = initializers.iterator();</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">		while(var4.hasNext()) {</span>
<span class="nc" id="L61">	         ModuleInitializer initializer = (ModuleInitializer)var4.next();</span>
<span class="nc" id="L62">	         System.out.println(String.format(&quot;%1$s Start: %2$s %1$s&quot;, &quot;==========&quot;, initializer.getClass().getSimpleName()));</span>
<span class="nc" id="L63">	         long t0 = System.currentTimeMillis();</span>
	        // initializer.init(dataSource,driver);
<span class="nc" id="L65">	         System.out.println(String.format(&quot;%1$s End: %2$s (time: %3$d ms.) %1$s&quot;, &quot;----------&quot;, initializer.getClass().getSimpleName(), System.currentTimeMillis() - t0));</span>
<span class="nc" id="L66">	      }</span>
<span class="nc" id="L67">	}</span>
	
	@SuppressWarnings(&quot;unused&quot;)
	public static  Connection getDBConnection() throws Exception{
<span class="fc" id="L71">		Connection c = null;</span>
<span class="fc" id="L72">		Class.forName(DBConstants.DRIVER);</span>
		try {		
<span class="fc" id="L74">			init();</span>
			 /*c = dataSource.getConnection();
			 if(null != c){
				 c.setAutoCommit(false);
			 } */        
	         
<span class="nc" id="L80">		}catch (Exception var16) {</span>
<span class="nc" id="L81">			var16.printStackTrace();</span>
			/*if (c != null) {
	             try {
	                c.rollback();
	             } catch (SQLException var15) {
	                System.out.println(&quot;Unable to rollback ...&quot;+ var15);
	             }
	          }
<span class="nc" id="L89">*/	          throw var16;</span>
<span class="fc" id="L90">		}</span>
<span class="fc" id="L91">		return c;</span>
	}

	@SuppressWarnings(&quot;unused&quot;)
	private static  Connection getConnection() {
<span class="nc" id="L96">		Connection c = null;</span>
		try {
<span class="nc" id="L98">			System.out.println(&quot;url::::&quot; + url);</span>

<span class="nc" id="L100">			Properties properties = new Properties();</span>
<span class="nc" id="L101">			properties.put(&quot;create&quot;, &quot;true&quot;);</span>
<span class="nc" id="L102">			properties.put(&quot;user&quot;, DBConstants.USER);</span>
<span class="nc" id="L103">			properties.put(&quot;password&quot;, DBConstants.PASS);</span>

<span class="nc" id="L105">			c = DriverManager.getConnection(url,DBConstants.USER,DBConstants.PASS);</span>
			
			/*if (c != null) {
				System.out.println(&quot;Connected to database #3&quot;);
			} else {
				System.out.println(&quot;Not Connected to database&quot;);
			}*/

<span class="nc" id="L113">		}catch (Exception var1) {</span>
<span class="nc" id="L114">			var1.printStackTrace();</span>
<span class="nc" id="L115">		}</span>
<span class="nc" id="L116">		return c;</span>
	}
	
		
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>